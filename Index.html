<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#667eea">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Task Manager Pro">
<meta name="description" content="Task Manager Pro - 5 modalità complete per gestire ogni attività">
<link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23667eea'/%3E%3Ctext x='50' y='65' font-size='60' text-anchor='middle' fill='white'%3E📋%3C/text%3E%3C/svg%3E">
<title>Task Manager Pro</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',system-ui,-apple-system,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:10px;position:relative;overflow-x:hidden}
body::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");pointer-events:none;opacity:0.3}
.container{max-width:520px;margin:0 auto;background:rgba(255,255,255,0.98);border-radius:24px;box-shadow:0 20px 60px rgba(0,0,0,0.3),0 0 0 1px rgba(255,255,255,0.1);overflow:hidden;backdrop-filter:blur(10px);position:relative;animation:slideIn 0.5s ease-out}
@keyframes slideIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
.header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:20px;color:#fff;text-align:center;position:relative;box-shadow:0 4px 20px rgba(102,126,234,0.3)}
.header::after{content:'';position:absolute;bottom:0;left:0;right:0;height:40px;background:linear-gradient(to bottom,transparent,rgba(255,255,255,0.1));pointer-events:none}
.header h1{font-size:24px;font-weight:700;margin-bottom:8px;text-shadow:0 2px 10px rgba(0,0,0,0.2);letter-spacing:-0.5px}
.header p{font-size:13px;opacity:0.95;font-weight:500}
.content{padding:20px}
.mode-selector{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:20px}
.mode-btn{padding:12px 8px;border:2px solid transparent;border-radius:12px;background:linear-gradient(145deg,#f8f9ff,#e8eaf6);cursor:pointer;text-align:center;font-size:11px;font-weight:700;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);box-shadow:0 2px 8px rgba(0,0,0,0.05);text-transform:uppercase;letter-spacing:0.3px}
.mode-btn:hover{transform:translateY(-3px);box-shadow:0 6px 20px rgba(102,126,234,0.25);border-color:rgba(102,126,234,0.3)}
.mode-btn.active{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-color:transparent;box-shadow:0 8px 25px rgba(102,126,234,0.4);transform:translateY(-2px)}
.mode-icon{font-size:24px;display:block;margin-bottom:6px;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.1))}
.upload-section{display:flex;gap:10px;margin-bottom:15px;justify-content:center}
.upload-btn{padding:14px 24px;background:linear-gradient(135deg,#9c27b0,#ba68c8);color:#fff;border:none;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;transition:all 0.3s ease;box-shadow:0 4px 15px rgba(156,39,176,0.3);position:relative;overflow:hidden}
.upload-btn::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:rgba(255,255,255,0.3);transform:translate(-50%,-50%);transition:width 0.6s,height 0.6s}
.upload-btn:hover::before{width:300px;height:300px}
.upload-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(156,39,176,0.4)}
.upload-btn:active{transform:translateY(0)}
textarea{width:100%;min-height:100px;padding:16px;border:2px solid #e8eaf6;border-radius:12px;font-size:15px;resize:none;font-family:inherit;transition:all 0.3s ease;background:linear-gradient(145deg,#ffffff,#f8f9ff);box-shadow:inset 0 2px 8px rgba(0,0,0,0.03);word-wrap:break-word;overflow-wrap:break-word}
textarea:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 4px rgba(102,126,234,0.1),inset 0 2px 8px rgba(0,0,0,0.03);background:#ffffff}
textarea::placeholder{color:#999;font-weight:500}
.btn{width:100%;padding:16px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;margin-top:12px;transition:all 0.3s ease;box-shadow:0 6px 20px rgba(102,126,234,0.35);position:relative;overflow:hidden}
.btn::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:rgba(255,255,255,0.3);transform:translate(-50%,-50%);transition:width 0.6s,height 0.6s}
.btn:hover::before{width:400px;height:400px}
.btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(102,126,234,0.45)}
.btn:active{transform:translateY(0)}
.hint{background:linear-gradient(135deg,#fff8e1,#ffecb3);padding:12px 16px;border-radius:10px;font-size:12px;color:#f57c00;margin-top:12px;border-left:4px solid #ff9800;font-weight:600;box-shadow:0 2px 8px rgba(255,152,0,0.15);word-wrap:break-word;overflow-wrap:break-word}
.stats{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:linear-gradient(145deg,#f8f9ff,#e8eaf6);border-radius:14px;margin-bottom:15px;box-shadow:inset 0 2px 8px rgba(0,0,0,0.05);flex-wrap:nowrap;gap:8px;overflow-x:auto}
.stat{text-align:center;min-width:55px;flex-shrink:0}
.stat-number{font-size:20px;font-weight:700;color:#667eea;display:block;text-shadow:0 2px 4px rgba(102,126,234,0.2)}
.stat-label{font-size:9px;color:#666;text-transform:uppercase;font-weight:700;letter-spacing:0.3px;margin-top:2px;white-space:nowrap}
.progress-bar{height:6px;background:linear-gradient(90deg,#e0e0e0,#f0f0f0);border-radius:10px;margin:12px 0;overflow:hidden;box-shadow:inset 0 2px 4px rgba(0,0,0,0.1)}
.progress-fill{height:100%;background:linear-gradient(90deg,#4caf50,#8bc34a);transition:width 0.6s cubic-bezier(0.4,0,0.2,1);border-radius:10px;box-shadow:0 0 10px rgba(76,175,80,0.5);position:relative}
.progress-fill::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:shimmer 2s infinite}
@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.list{max-height:450px;overflow-y:auto;padding-right:5px}
.list::-webkit-scrollbar{width:8px}
.list::-webkit-scrollbar-track{background:linear-gradient(145deg,#f0f0f0,#e0e0e0);border-radius:10px}
.list::-webkit-scrollbar-thumb{background:linear-gradient(135deg,#667eea,#764ba2);border-radius:10px;box-shadow:inset 0 0 6px rgba(0,0,0,0.3)}
.list::-webkit-scrollbar-thumb:hover{background:linear-gradient(135deg,#5568d3,#6a3d8f)}
.item{display:flex;align-items:center;padding:10px 12px;background:#fff;border:2px solid #f0f0f0;border-radius:10px;margin-bottom:8px;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);box-shadow:0 2px 8px rgba(0,0,0,0.04);animation:itemSlide 0.4s ease-out;word-wrap:break-word;overflow-wrap:break-word;min-height:50px}
@keyframes itemSlide{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}
.item:hover{border-color:#667eea;box-shadow:0 6px 20px rgba(102,126,234,0.2);transform:translateY(-2px)}
.item.done{background:linear-gradient(135deg,#e8f5e9,#c8e6c9);border-color:#4caf50;box-shadow:0 4px 12px rgba(76,175,80,0.25)}
.item.warn{background:linear-gradient(135deg,#fff3e0,#ffe0b2);border-color:#ff9800;box-shadow:0 4px 12px rgba(255,152,0,0.25)}
.item.alert{background:linear-gradient(135deg,#ffebee,#ffcdd2);border-color:#f44336;box-shadow:0 4px 12px rgba(244,67,54,0.25)}
.item-content{flex-grow:1;min-width:0;word-wrap:break-word;overflow-wrap:break-word}
.item-name{font-size:14px;font-weight:600;color:#333;line-height:1.3;word-wrap:break-word;overflow-wrap:break-word;overflow:hidden}
.item.done .item-name{text-decoration:line-through;color:#999;opacity:0.7}
.item.notfound{background:linear-gradient(135deg,#fff3e0,#ffe0b2);border-color:#ff9800;box-shadow:0 4px 12px rgba(255,152,0,0.25)}
.item-qty{font-size:11px;color:#fff;font-weight:700;background:linear-gradient(135deg,#ff6b6b,#ff8e53);padding:4px 10px;border-radius:8px;display:inline-block;margin-bottom:5px;box-shadow:0 2px 6px rgba(255,107,107,0.3);text-transform:uppercase;letter-spacing:0.3px}
.checks{display:flex;gap:5px;margin-left:8px;flex-shrink:0}
.check{width:34px;height:34px;border:2px solid #e0e0e0;border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:15px;background:#fff;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);box-shadow:0 2px 6px rgba(0,0,0,0.05);position:relative;flex-shrink:0}
.check:hover{transform:scale(1.15);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
.check:active{transform:scale(1.05)}
.check.done{background:linear-gradient(135deg,#4caf50,#66bb6a);border-color:#4caf50;box-shadow:0 4px 12px rgba(76,175,80,0.4);color:#fff}
.check.warn{background:linear-gradient(135deg,#ff9800,#ffa726);border-color:#ff9800;box-shadow:0 4px 12px rgba(255,152,0,0.4);color:#fff}
.check.alert{background:linear-gradient(135deg,#f44336,#e57373);border-color:#f44336;box-shadow:0 4px 12px rgba(244,67,54,0.4);color:#fff}
.check.blue{background:linear-gradient(135deg,#2196f3,#42a5f5);border-color:#2196f3;box-shadow:0 4px 12px rgba(33,150,243,0.4);color:#fff}
.check.purple{background:linear-gradient(135deg,#9c27b0,#ba68c8);border-color:#9c27b0;box-shadow:0 4px 12px rgba(156,39,176,0.4);color:#fff}
.check.notfound{background:linear-gradient(135deg,#ff9800,#ffa726);border-color:#ff9800;box-shadow:0 4px 12px rgba(255,152,0,0.4);color:#fff}
.tooltip{position:absolute;bottom:42px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.9);color:#fff;padding:6px 12px;border-radius:6px;font-size:10px;white-space:nowrap;opacity:0;pointer-events:none;transition:opacity 0.3s ease;font-weight:600;box-shadow:0 4px 12px rgba(0,0,0,0.3);z-index:100}
.tooltip::after{content:'';position:absolute;top:100%;left:50%;margin-left:-5px;border:5px solid transparent;border-top-color:rgba(0,0,0,0.9)}
.check:hover .tooltip{opacity:1}
.checkbox{width:24px;height:24px;border:2px solid #ddd;border-radius:6px;margin-right:12px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s ease;background:#fff;box-shadow:0 2px 4px rgba(0,0,0,0.05);flex-shrink:0}
.checkbox:hover{transform:scale(1.1);border-color:#667eea}
.checkbox.checked{background:linear-gradient(135deg,#4caf50,#66bb6a);border-color:#4caf50;box-shadow:0 4px 10px rgba(76,175,80,0.3);transform:scale(1.05)}
.checkmark{display:none;color:#fff;font-size:14px;font-weight:700}
.checkbox.checked .checkmark{display:block;animation:checkPop 0.3s cubic-bezier(0.68,-0.55,0.265,1.55)}
@keyframes checkPop{0%{transform:scale(0)}50%{transform:scale(1.2)}100%{transform:scale(1)}}
.del-btn{width:32px;height:32px;border-radius:8px;background:linear-gradient(135deg,#ffebee,#ffcdd2);border:none;color:#f44336;font-size:18px;cursor:pointer;opacity:0;margin-left:10px;transition:all 0.3s ease;box-shadow:0 2px 6px rgba(244,67,54,0.2);flex-shrink:0}
.item:hover .del-btn{opacity:1}
.del-btn:hover{transform:scale(1.15);background:linear-gradient(135deg,#f44336,#e57373);color:#fff;box-shadow:0 4px 12px rgba(244,67,54,0.4)}
.del-btn:active{transform:scale(1)}
.empty{text-align:center;padding:50px 20px;color:#999}
.empty-icon{font-size:60px;opacity:0.5;margin-bottom:15px;filter:drop-shadow(0 4px 8px rgba(0,0,0,0.1));animation:float 3s ease-in-out infinite}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.empty p{font-size:16px;font-weight:600}
.actions{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:15px}
.action-btn{padding:12px;background:#fff;color:#667eea;border:2px solid #667eea;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);box-shadow:0 2px 8px rgba(0,0,0,0.05);text-transform:uppercase;letter-spacing:0.3px}
.action-btn:hover{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;transform:translateY(-2px);box-shadow:0 6px 18px rgba(102,126,234,0.3)}
.action-btn:active{transform:translateY(0)}
.action-btn.danger{color:#f44336;border-color:#f44336}
.action-btn.danger:hover{background:linear-gradient(135deg,#f44336,#e57373)}
.action-btn.success{color:#10a37f;border-color:#10a37f}
.action-btn.success:hover{background:linear-gradient(135deg,#10a37f,#0d8f6f)}
.location-input{width:100%;padding:14px;border:2px solid #e8eaf6;border-radius:10px;font-size:14px;margin-bottom:12px;transition:all 0.3s ease;background:linear-gradient(145deg,#ffffff,#f8f9ff);font-family:inherit;font-weight:500}
.location-input:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 4px rgba(102,126,234,0.1);background:#fff}
.location-label{font-size:13px;font-weight:700;color:#667eea;margin-bottom:8px;display:block;text-transform:uppercase;letter-spacing:0.5px}
.loading{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);display:none;justify-content:center;align-items:center;z-index:9999;backdrop-filter:blur(10px)}
.loading.show{display:flex}
.loading-content{background:#fff;padding:40px;border-radius:20px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.5);animation:scaleIn 0.3s ease-out}
@keyframes scaleIn{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:scale(1)}}
.spinner{width:60px;height:60px;border:6px solid #f3f3f3;border-top:6px solid #667eea;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 20px}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.loading-text{font-size:16px;color:#333;font-weight:700}
.msg-box{background:linear-gradient(145deg,#f8f9ff,#e8eaf6);border:2px solid #667eea;border-radius:14px;padding:18px;margin-bottom:15px;font-size:13px;white-space:pre-wrap;font-family:'Courier New',monospace;box-shadow:inset 0 2px 8px rgba(0,0,0,0.05);line-height:1.6;word-wrap:break-word;overflow-wrap:break-word}
.warehouse-num{width:34px;height:34px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:15px;margin-right:14px;box-shadow:0 4px 12px rgba(102,126,234,0.4);flex-shrink:0}
.legend{background:linear-gradient(145deg,#f8f9ff,#e8eaf6);padding:14px;border-radius:12px;margin-bottom:15px;font-size:12px;box-shadow:inset 0 2px 8px rgba(0,0,0,0.05)}
.legend-item{display:flex;align-items:center;gap:10px;margin-bottom:8px;font-weight:600}
.legend-item:last-child{margin-bottom:0}
.legend-icon{width:18px;height:18px;border-radius:5px;color:#fff;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;box-shadow:0 2px 6px rgba(0,0,0,0.2);flex-shrink:0}
.notice{background:linear-gradient(135deg,#e3f2fd,#bbdefb);padding:12px 16px;border-radius:10px;font-size:12px;color:#1976d2;margin-bottom:15px;border-left:4px solid #2196f3;font-weight:600;box-shadow:0 2px 8px rgba(33,150,243,0.15);animation:slideDown 0.4s ease-out}
@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
.counter-result{background:linear-gradient(135deg,#667eea,#764ba2);padding:30px 20px;border-radius:16px;margin-bottom:15px;box-shadow:0 8px 25px rgba(102,126,234,0.4);animation:scaleIn 0.5s ease-out}
.counter-main{text-align:center;margin-bottom:20px}
.counter-number{font-size:72px;font-weight:700;color:#fff;display:block;text-shadow:0 4px 12px rgba(0,0,0,0.3);margin-bottom:10px;animation:popIn 0.6s cubic-bezier(0.68,-0.55,0.265,1.55)}
@keyframes popIn{0%{transform:scale(0)}50%{transform:scale(1.1)}100%{transform:scale(1)}}
.counter-label{font-size:20px;color:#fff;font-weight:600;text-transform:uppercase;letter-spacing:1px;opacity:0.95}
.counter-details{background:rgba(255,255,255,0.15);padding:20px;border-radius:12px;backdrop-filter:blur(10px);display:grid;grid-template-columns:repeat(2,1fr);gap:15px}
.counter-detail-item{color:#fff;text-align:center;padding:15px;background:rgba(255,255,255,0.1);border-radius:10px;backdrop-filter:blur(5px)}
.counter-detail-number{font-size:28px;font-weight:700;display:block;margin-bottom:5px}
.counter-detail-label{font-size:12px;opacity:0.9;text-transform:uppercase;letter-spacing:0.5px}
.install-banner{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:16px 24px;border-radius:16px;box-shadow:0 8px 30px rgba(102,126,234,0.5);z-index:10000;display:none;align-items:center;gap:15px;animation:slideUp 0.4s ease-out;max-width:90%}
@keyframes slideUp{from{opacity:0;transform:translateX(-50%) translateY(20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
.install-banner.show{display:flex}
.install-banner-text{flex:1}
.install-banner-title{font-size:16px;font-weight:700;margin-bottom:4px}
.install-banner-desc{font-size:12px;opacity:0.9}
.install-btn{background:#fff;color:#667eea;border:none;padding:10px 20px;border-radius:10px;font-weight:700;font-size:14px;cursor:pointer;transition:all 0.3s ease;box-shadow:0 4px 12px rgba(0,0,0,0.2)}
.install-btn:hover{transform:scale(1.05);box-shadow:0 6px 16px rgba(0,0,0,0.3)}
.install-close{background:transparent;border:none;color:#fff;font-size:24px;cursor:pointer;opacity:0.8;padding:0 8px;transition:opacity 0.3s}
.install-close:hover{opacity:1}
@media (max-width: 480px){
.mode-selector{grid-template-columns:repeat(3,1fr)}
.checks{flex-wrap:nowrap}
.check{width:30px;height:30px;font-size:13px}
.counter-details{grid-template-columns:1fr}
.counter-number{font-size:56px}
.item{padding:8px 10px}
.stat{min-width:50px}
.stat-number{font-size:18px}
.stat-label{font-size:8px}
}
</style>
</head>
<body>
<div class="install-banner" id="installBanner">
<div class="install-banner-text">
<div class="install-banner-title">📱 Installa l'App</div>
<div class="install-banner-desc">Usa Task Manager come app nativa!</div>
</div>
<button class="install-btn" id="installBtn">Installa</button>
<button class="install-close" id="installClose">×</button>
</div>
<div class="loading" id="loading"><div class="loading-content"><div class="spinner"></div><div class="loading-text" id="loadingText">Caricamento...</div></div></div>
<div class="container">
<div class="header"><h1>📋 Task Manager Pro</h1><p>5 modalità complete per gestire ogni attività</p></div>
<div class="content">
<div class="mode-selector">
<div class="mode-btn active" onclick="app.setMode('shopping')"><span class="mode-icon">🛒</span>Spesa</div>
<div class="mode-btn" onclick="app.setMode('testing')"><span class="mode-icon">🔧</span>Collaudi</div>
<div class="mode-btn" onclick="app.setMode('photos')"><span class="mode-icon">📷</span>Foto</div>
<div class="mode-btn" onclick="app.setMode('warehouse')"><span class="mode-icon">📦</span>Magazzino</div>
<div class="mode-btn" onclick="app.setMode('counter')"><span class="mode-icon">🔢</span>Conteggio</div>
</div>
<div id="inputSection">
<div class="upload-section">
<label for="photoUpload" class="upload-btn">📸 Carica Foto</label>
<input type="file" id="photoUpload" style="display:none" accept="image/*">
</div>
<textarea id="messageInput" placeholder=""></textarea>
<div class="hint" id="hint"></div>
<button class="btn" onclick="app.create()" id="mainBtn">✨ Crea Lista</button>
</div>
<div id="notice" style="display:none" class="notice"></div>
<div id="locationSection" style="display:none">
<label class="location-label">📍 Luogo</label>
<input type="text" id="locationInput" class="location-input" placeholder="Es: Cantiere Nord...">
</div>
<div id="actionSection" style="display:none">
<div class="actions">
<button class="action-btn" onclick="app.reset()">↺ Reset</button>
<button class="action-btn danger" onclick="app.clear()">🗑️ Cancella</button>
<button class="action-btn success" id="excelBtn" onclick="app.exportExcel()">📊 Excel</button>
</div>
</div>
<div id="counterResult" style="display:none"></div>
<div id="warehouseMsg" style="display:none"><div class="msg-box" id="msgPreview"></div></div>
<div id="legendSection" style="display:none"></div>
<div id="statsSection" style="display:none"></div>
<div id="list" class="list"><div class="empty"><div class="empty-icon">📝</div><p>Seleziona una modalità per iniziare</p></div></div>
</div>
</div>
<script>
const app={mode:'shopping',data:{shopping:[],testing:[],photos:[],warehouse:[]},location:'',init(){const saved=localStorage.getItem('taskData');if(saved){this.data=JSON.parse(saved)}this.setupEvents();this.setMode('shopping')},setupEvents(){document.getElementById('photoUpload').onchange=e=>this.handlePhoto(e);document.getElementById('locationInput').onchange=()=>{this.location=document.getElementById('locationInput').value;this.save()}},setMode(m){this.mode=m;document.querySelectorAll('.mode-btn').forEach(b=>b.classList.remove('active'));event.target.closest('.mode-btn').classList.add('active');const input=document.getElementById('messageInput'),hint=document.getElementById('hint'),btn=document.getElementById('mainBtn');const placeholders={'shopping':'Lista spesa...\n\nEs:\nlatte 2L\npane\npomodori 1kg','testing':'Elenco collaudi...\n\nEs:\nCollaudo impianto elettrico\nTest ascensore','photos':'Elenco foto da fare...\n\nEs:\nPozzetto 1\nPozzetto 2\nArmadio distribuzione','warehouse':'Materiale magazzino...\n\nEs:\nCavi 10mm 50mt\nInterruttori differenziali 10pz','counter':'Testo da contare...\n\nIncolla qui il testo'};const hints={'shopping':'💡 Scrivi un prodotto per riga o carica una foto della lista!','testing':'💡 Scrivi un collaudo per riga o carica una foto dell\'elenco!','photos':'💡 Scrivi una foto per riga o carica l\'elenco!','warehouse':'💡 Scrivi un materiale per riga o carica la richiesta!','counter':'💡 Incolla il testo da contare o carica una foto!'};const btnTexts={'shopping':'✨ Crea Lista Spesa','testing':'✨ Crea Elenco Collaudi','photos':'✨ Crea Elenco Foto','warehouse':'✨ Crea Richiesta Magazzino','counter':'🔢 Conta Elementi'};input.placeholder=placeholders[m]||'';hint.innerHTML=hints[m]||'';btn.textContent=btnTexts[m]||'Crea';this.loadMode()},getItems(){return this.data[this.mode]||[]},setItems(items){this.data[this.mode]=items;this.save()},save(){localStorage.setItem('taskData',JSON.stringify(this.data))},create(){if(this.mode==='counter'){this.count();return}const input=document.getElementById('messageInput').value;if(!input.trim()){alert('📝 Inserisci prima i dati!');return}const lines=input.split('\n').filter(l=>l.trim());let items=[];if(this.mode==='warehouse'){lines.forEach(l=>{const p=this.parseItem(l);items.push({name:p.name,qty:p.qty})})}else if(this.mode==='shopping'){lines.forEach(l=>{const p=this.parseItem(l);items.push({name:p.name,qty:p.qty,checked:false,notfound:false})})}else if(this.mode==='testing'){lines.forEach(l=>{items.push({name:this.capitalize(l),done:false,label:false,help:false})})}else if(this.mode==='photos'){lines.forEach(l=>{items.push({name:this.capitalize(l),photo:false,cable:false,empty:false,merged:false})})}const unique=this.removeDuplicates(items);const dupes=items.length-unique.length;this.setItems(unique);if(this.mode==='testing'||this.mode==='photos'){const sorted=this.getItems().sort((a,b)=>a.name.localeCompare(b.name,'it'));this.setItems(sorted)}if(dupes>0){document.getElementById('notice').textContent='ℹ️ Rimossi '+dupes+' duplicat'+(dupes>1?'i':'o');document.getElementById('notice').style.display='block';setTimeout(()=>{document.getElementById('notice').style.display='none'},5000)}this.loadMode()},count(){const input=document.getElementById('messageInput').value;if(!input.trim()){alert('📝 Inserisci prima il testo!');return}const lines=input.split('\n').filter(l=>l.trim());const words=input.trim().split(/\s+/).filter(w=>w);const chars=input.length;const charsNoSpaces=input.replace(/\s/g,'').length;let html='<div class="counter-result">';html+='<div class="counter-main">';html+='<div class="counter-number">'+lines.length+'</div>';html+='<div class="counter-label">🔢 Elementi Trovati</div>';html+='</div>';html+='<div class="counter-details">';html+='<div class="counter-detail-item"><span class="counter-detail-number">'+lines.length+'</span><span class="counter-detail-label">📝 Righe</span></div>';html+='<div class="counter-detail-item"><span class="counter-detail-number">'+words.length+'</span><span class="counter-detail-label">📖 Parole</span></div>';html+='<div class="counter-detail-item"><span class="counter-detail-number">'+chars+'</span><span class="counter-detail-label">🔤 Caratteri</span></div>';html+='<div class="counter-detail-item"><span class="counter-detail-number">'+charsNoSpaces+'</span><span class="counter-detail-label">🔡 Senza Spazi</span></div>';html+='</div></div>';document.getElementById('counterResult').innerHTML=html;document.getElementById('counterResult').style.display='block';document.getElementById('list').style.display='none'},parseItem(line){const match=line.match(/^(.+?)\s+(\d+[\.,]?\d*\s*(?:kg|g|l|ml|pz|mt|litri|litro|pezzi|pezzo))\s*$/i);if(match){return{name:this.capitalize(match[1]),qty:match[2].toLowerCase().replace('litri','l').replace('litro','l').replace('pezzi','pz').replace('pezzo','pz')}}return{name:this.capitalize(line),qty:null}},capitalize(str){return str.split(' ').map(w=>w.length>2?w.charAt(0).toUpperCase()+w.slice(1).toLowerCase():w.toLowerCase()).join(' ')},removeDuplicates(items){const seen=new Set();return items.filter(item=>{const key=item.name.toLowerCase();if(seen.has(key))return false;seen.add(key);return true})},loadMode(){if(this.mode==='counter'){document.getElementById('inputSection').style.display='block';document.getElementById('actionSection').style.display='none';document.getElementById('statsSection').style.display='none';document.getElementById('legendSection').style.display='none';document.getElementById('locationSection').style.display='none';document.getElementById('warehouseMsg').style.display='none';document.getElementById('counterResult').style.display='none';document.getElementById('list').innerHTML='<div class="empty"><div class="empty-icon">🔢</div><p>Inserisci il testo da contare</p></div>';document.getElementById('list').style.display='block';return}const items=this.getItems();if(items.length>0){document.getElementById('inputSection').style.display='none';document.getElementById('actionSection').style.display='block';document.getElementById('counterResult').style.display='none';document.getElementById('list').style.display='block';if(this.mode==='testing'||this.mode==='photos'){document.getElementById('locationSection').style.display='block';document.getElementById('legendSection').style.display='block';document.getElementById('excelBtn').style.display='block';this.updateLegend()}else if(this.mode==='warehouse'){document.getElementById('warehouseMsg').style.display='block';document.getElementById('excelBtn').style.display='none';document.getElementById('locationSection').style.display='none';document.getElementById('legendSection').style.display='none';this.updateMsg()}else{document.getElementById('locationSection').style.display='none';document.getElementById('legendSection').style.display='none';document.getElementById('warehouseMsg').style.display='none';document.getElementById('excelBtn').style.display='none'}this.updateStats();this.render()}else{document.getElementById('inputSection').style.display='block';document.getElementById('actionSection').style.display='none';document.getElementById('statsSection').style.display='none';document.getElementById('legendSection').style.display='none';document.getElementById('locationSection').style.display='none';document.getElementById('warehouseMsg').style.display='none';document.getElementById('counterResult').style.display='none';document.getElementById('list').innerHTML='<div class="empty"><div class="empty-icon">📝</div><p>Inserisci i dati per iniziare</p></div>';document.getElementById('list').style.display='block'}},updateLegend(){let html='<div class="legend">';if(this.mode==='testing'){html+='<div class="legend-item"><div class="legend-icon" style="background:#4caf50">✓</div><span><strong>Verde:</strong> Completato</span></div>';html+='<div class="legend-item"><div class="legend-icon" style="background:#ff9800">🏷</div><span><strong>Arancio:</strong> Manca Label/ID</span></div>';html+='<div class="legend-item"><div class="legend-icon" style="background:#f44336">❗</div><span><strong>Rosso:</strong> Da chiarire con assistente</span></div>'}else if(this.mode==='photos'){html+='<div class="legend-item"><div class="legend-icon" style="background:#4caf50">✓</div><span><strong>Verde:</strong> Foto fatta</span></div>';html+='<div class="legend-item"><div class="legend-icon" style="background:#2196f3">🎞</div><span><strong>Blu:</strong> Cavo a roccetta</span></div>';html+='<div class="legend-item"><div class="legend-icon" style="background:#ff9800">○</div><span><strong>Arancio:</strong> Pozzetto vuoto</span></div>';html+='<div class="legend-item"><div class="legend-icon" style="background:#9c27b0">⊕</div><span><strong>Viola:</strong> Accorpato</span></div>'}html+='</div>';document.getElementById('legendSection').innerHTML=html},updateMsg(){const items=this.getItems();let msg='📦 RICHIESTA MATERIALE MAGAZZINO\n\nBuongiorno,\nho bisogno del seguente materiale:\n\n';items.forEach((item,i)=>{msg+=(i+1)+'. '+item.name;if(item.qty)msg+=' - '+item.qty;msg+='\n'});msg+='\nGrazie mille';document.getElementById('msgPreview').textContent=msg},updateStats(){const items=this.getItems();const total=items.length;let html='<div class="stats">';if(this.mode==='testing'){const done=items.filter(i=>i.done&&!i.label&&!i.help).length;const label=items.filter(i=>i.label).length;const help=items.filter(i=>i.help).length;const none=total-done-label-help;html+='<div class="stat"><span class="stat-number">'+total+'</span><span class="stat-label">Totale</span></div>';html+='<div class="stat"><span class="stat-number" style="color:#4caf50">'+done+'</span><span class="stat-label">Fatti</span></div>';html+='<div class="stat"><span class="stat-number" style="color:#ff9800">'+label+'</span><span class="stat-label">No Label</span></div>';html+='<div class="stat"><span class="stat-number" style="color:#f44336">'+help+'</span><span class="stat-label">Da Chiarire</span></div>';html+='<div class="stat"><span class="stat-number" style="color:#9e9e9e">'+none+'</span><span class="stat-label">Non Iniziati</span></div>';html+='</div><div class="progress-bar"><div class="progress-fill" style="width:'+(total>0?(done/total)*100:0)+'%"></div></div>'}else if(this.mode==='photos'){const done=items.filter(i=>i.photo).length;const cable=items.filter(i=>i.cable).length;const empty=items.filter(i=>i.empty).length;const merged=items.filter(i=>i.merged).length;html+='<div class="stat"><span class="stat-number">'+total+'</span><span class="stat-label">Totale</span></div>';html+='<div class="stat"><span class="stat-number" style="color:#4caf50">'+done+'</span><span class="stat-label">Fatte</span></div>';html+='<div class="stat"><span class="stat-number" style="color:#2196f3">'+cable+'</span><span class="stat-label">Roccetta</span></div>';html+='<div class="stat"><span class="stat-number" style="color:#ff9800">'+empty+'</span><span class="stat-label">Vuoto</span></div>';html+='<div class="stat"><span class="stat-number" style="color:#9c27b0">'+merged+'</span><span class="stat-label">Accorpato</span></div>';html+='</div><div class="progress-bar"><div class="progress-fill" style="width:'+(total>0?(done/total)*100:0)+'%"></div></div>'}else{const done=items.filter(i=>i.checked).length;const left=total-done;const notfound=items.filter(i=>i.notfound).length;html+='<div class="stat"><span class="stat-number">'+total+'</span><span class="stat-label">Totale</span></div>';html+='<div class="stat"><span class="stat-number">'+done+'</span><span class="stat-label">Presi</span></div>';html+='<div class="stat"><span class="stat-number">'+left+'</span><span class="stat-label">Mancanti</span></div>';html+='<div class="stat"><span class="stat-number" style="color:#ff9800">'+notfound+'</span><span class="stat-label">Non Trovati</span></div>';html+='</div><div class="progress-bar"><div class="progress-fill" style="width:'+(total>0?(done/total)*100:0)+'%"></div></div>'}document.getElementById('statsSection').innerHTML=html;document.getElementById('statsSection').style.display='block'},render(){const items=this.getItems();let html='';if(this.mode==='warehouse'){items.forEach((item,i)=>{html+='<div class="item"><div class="warehouse-num">'+(i+1)+'</div><div class="item-content">';if(item.qty)html+='<div class="item-qty">📦 '+item.qty+'</div>';html+='<div class="item-name">'+item.name+'</div></div><button class="del-btn" onclick="app.del('+i+')">×</button></div>'})}else if(this.mode==='shopping'){items.forEach((item,i)=>{let cls='';if(item.checked)cls='done';else if(item.notfound)cls='notfound';html+='<div class="item '+cls+'" onclick="app.toggle('+i+')">';html+='<div class="checkbox '+(item.checked?'checked':'')+'"><span class="checkmark">✓</span></div>';html+='<div class="item-content">';if(item.qty)html+='<div class="item-qty">📦 '+item.qty+'</div>';html+='<div class="item-name">'+item.name+'</div></div>';html+='<div class="checks">';html+='<div class="check '+(item.notfound?'notfound':'')+'" onclick="app.toggleNotFound('+i+')" style="margin-left:8px">'+(item.notfound?'✗':'○')+'<div class="tooltip">Non Trovato</div></div>';html+='</div>';html+='<button class="del-btn" onclick="app.del('+i+')">×</button></div>'})}else if(this.mode==='testing'){items.forEach((item,i)=>{let cls='';if(item.done&&!item.label&&!item.help)cls='done';else if(item.help)cls='alert';else if(item.label)cls='warn';html+='<div class="item '+cls+'"><div class="item-content"><div class="item-name">'+item.name+'</div></div><div class="checks">';html+='<div class="check '+(item.done?'done':'')+'" onclick="app.toggleCheck('+i+',\'done\')">'+(item.done?'✓':'○')+'<div class="tooltip">Completato</div></div>';html+='<div class="check '+(item.label?'warn':'')+'" onclick="app.toggleCheck('+i+',\'label\')">'+(item.label?'🏷️':'🏷')+'<div class="tooltip">Manca Label</div></div>';html+='<div class="check '+(item.help?'alert':'')+'" onclick="app.toggleCheck('+i+',\'help\')">'+(item.help?'❗':'?')+'<div class="tooltip">Da Chiarire</div></div></div>';html+='<button class="del-btn" onclick="app.del('+i+')">×</button></div>'})}else if(this.mode==='photos'){items.forEach((item,i)=>{let cls='';if(item.photo&&!item.cable&&!item.empty&&!item.merged)cls='done';html+='<div class="item '+cls+'"><div class="item-content"><div class="item-name">'+item.name+'</div></div><div class="checks">';html+='<div class="check '+(item.photo?'done':'')+'" onclick="app.toggleCheck('+i+',\'photo\')">'+(item.photo?'✓':'○')+'<div class="tooltip">Foto Fatta</div></div>';html+='<div class="check '+(item.cable?'blue':'')+'" onclick="app.toggleCheck('+i+',\'cable\')">'+(item.cable?'🎞':'○')+'<div class="tooltip">Cavo a Roccetta</div></div>';html+='<div class="check '+(item.empty?'warn':'')+'" onclick="app.toggleCheck('+i+',\'empty\')">○<div class="tooltip">Pozzetto Vuoto</div></div>';html+='<div class="check '+(item.merged?'purple':'')+'" onclick="app.toggleCheck('+i+',\'merged\')">'+(item.merged?'⊕':'○')+'<div class="tooltip">Accorpato</div></div></div>';html+='<button class="del-btn" onclick="app.del('+i+')">×</button></div>'})}document.getElementById('list').innerHTML=html},toggle(i){const items=this.getItems();items[i].checked=!items[i].checked;this.setItems(items);this.render();this.updateStats();if(items.every(item=>item.checked)){setTimeout(()=>{if(confirm('🎉 Hai preso tutto!\n\nVuoi cancellare la lista?'))this.clear()},300)}},toggleCheck(i,prop){const items=this.getItems();items[i][prop]=!items[i][prop];this.setItems(items);this.render();this.updateStats()},toggleNotFound(i){event.stopPropagation();const items=this.getItems();items[i].notfound=!items[i].notfound;this.setItems(items);this.render();this.updateStats()},del(i){event.stopPropagation();const items=this.getItems();items.splice(i,1);this.setItems(items);if(items.length===0)this.reset();else{this.render();if(this.mode==='warehouse')this.updateMsg();else this.updateStats()}},reset(){const items=this.getItems();if(items.length===0){this.setItems([]);document.getElementById('messageInput').value='';document.getElementById('locationInput').value='';this.location='';document.getElementById('notice').style.display='none';document.getElementById('counterResult').style.display='none';document.getElementById('list').style.display='block';this.save();this.loadMode();return}if(this.mode==='shopping'){items.forEach(item=>{item.checked=false;item.notfound=false})}else if(this.mode==='testing'){items.forEach(item=>{item.done=false;item.label=false;item.help=false})}else if(this.mode==='photos'){items.forEach(item=>{item.photo=false;item.cable=false;item.empty=false;item.merged=false})}this.setItems(items);this.render();this.updateStats()},clear(){if(confirm('🗑️ Sei sicuro di voler cancellare tutto?')){this.setItems([]);document.getElementById('messageInput').value='';document.getElementById('locationInput').value='';this.location='';document.getElementById('notice').style.display='none';document.getElementById('counterResult').style.display='none';document.getElementById('list').style.display='block';this.save();this.loadMode()}},exportExcel(){if(this.mode==='testing'){const loc=document.getElementById('locationInput').value||'Non specificato';const data=[['Nome Collaudo','Stato','Luogo']];this.getItems().forEach(item=>{const stats=[];if(item.done)stats.push('✓ Fatto');if(item.label)stats.push('🏷 Manca Label');if(item.help)stats.push('❗ Da Chiarire');data.push([item.name,stats.join(', ')||'Da fare',loc])});const ws=XLSX.utils.aoa_to_sheet(data);ws['!cols']=[{wch:40},{wch:30},{wch:25}];const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,'Collaudi');XLSX.writeFile(wb,'Collaudi_'+new Date().toLocaleDateString('it-IT').replace(/\//g,'-')+'.xlsx')}else if(this.mode==='photos'){const loc=document.getElementById('locationInput').value||'Non specificato';const data=[['Nome Foto','Stato','Luogo']];this.getItems().forEach(item=>{const stats=[];if(item.photo)stats.push('✓ Foto Fatta');if(item.cable)stats.push('🎞 Cavo Roccetta');if(item.empty)stats.push('○ Vuoto');if(item.merged)stats.push('⊕ Accorpato');data.push([item.name,stats.join(', ')||'Da fare',loc])});const ws=XLSX.utils.aoa_to_sheet(data);ws['!cols']=[{wch:40},{wch:30},{wch:25}];const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,'Foto');XLSX.writeFile(wb,'Foto_'+new Date().toLocaleDateString('it-IT').replace(/\//g,'-')+'.xlsx')}},handlePhoto(e){const file=e.target.files[0];if(!file)return;if(!file.type.startsWith('image/')){alert('⚠️ Per favore carica solo immagini!');return}document.getElementById('loading').classList.add('show');document.getElementById('loadingText').textContent='Lettura in corso...';Tesseract.recognize(file,'ita',{logger:m=>{if(m.status==='recognizing text'){const pct=Math.round(m.progress*100);document.getElementById('loadingText').textContent='Lettura in corso... '+pct+'%'}}}).then(({data:{text}})=>{document.getElementById('loading').classList.remove('show');document.getElementById('messageInput').value=text;e.target.value='';alert('✅ Foto letta con successo!\n\nControlla il testo e premi il pulsante per creare la lista.')}).catch(err=>{document.getElementById('loading').classList.remove('show');alert('❌ Errore durante la lettura della foto.\n\nRiprova o inserisci manualmente il testo.');console.error(err);e.target.value=''})}};window.onload=()=>app.init();
let deferredPrompt;
window.addEventListener('beforeinstallprompt',e=>{
e.preventDefault();
deferredPrompt=e;
const banner=document.getElementById('installBanner');
const isInstalled=localStorage.getItem('appInstalled');
const isDismissed=sessionStorage.getItem('installDismissed');
if(!isInstalled&&!isDismissed){
setTimeout(()=>banner.classList.add('show'),2000);
}
});
document.getElementById('installBtn')?.addEventListener('click',async()=>{
if(!deferredPrompt)return;
deferredPrompt.prompt();
const{outcome}=await deferredPrompt.userChoice;
if(outcome==='accepted'){
localStorage.setItem('appInstalled','true');
document.getElementById('installBanner').classList.remove('show');
}
deferredPrompt=null;
});
document.getElementById('installClose')?.addEventListener('click',()=>{
sessionStorage.setItem('installDismissed','true');
document.getElementById('installBanner').classList.remove('show');
});
window.addEventListener('appinstalled',()=>{
localStorage.setItem('appInstalled','true');
document.getElementById('installBanner').classList.remove('show');
});
</script>
</body>
</html>